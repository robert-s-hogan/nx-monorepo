---
title: Projects DND interactive map
date: 'April 2023'
description: 'Here are my notes while building a DND interactive map with Konva and React'
categories: ['konva.js']
---

# 04.25.2023

[Here is the link](https://www.roberthogan.dev/projects/dnd-interactive-map)

## Konva setup

I started with a complete Konva setup with React. I used the React Konva starter thathas the green stars and started tweaking it to my needs. I am using it for a DND interactive map and need to have different icons and experiences.

### Few things I needed to adjust:

#### Setting boundaries for the draggable objects

The inital set up allowed icons to leave the Konva canvas and I didn't want that. Here is my solution:

```js const dragBoundFunc = (pos) => {
    const x = Math.max(
      playerRadius,
      Math.min(pos.x, stageSize.width - playerRadius)
    );
    const y = Math.max(
      playerRadius,
      Math.min(pos.y, stageSize.height - playerRadius)
    );
    return { x, y };
  };
```

#### Added SVG's with icons that represent DND classes that start in a similar location.

I wanted to add some starter classes: Fighter, Barbarian, and Wizard but I had some issues with sizing on the FighterPath. After a bunch of attempted fixes I adjusted the scale outside of the Player component and that seemed to work. Still not completely sure why the Fighter SVG was larger but that is a struggle for another day.

```js
import { Group, Path, Text } from 'react-konva';

const FighterIcon = (
  <Group scale={{ x: 0.08, y: 0.08 }}>
    <Path
      data="M255.996 0C209.875 55.353 136.065 87.638 53.039 92.25v189.12C53.039 405.914 255.996 512 255.996 512s202.966-106.086 202.966-230.63V92.25C375.926 87.638 302.116 55.353 255.996 0z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

const Player = ({ id, name, x, y, draggable, dragBoundFunc, className }) => {
  const radius = 20;
  const classShape = () => {
    switch (className) {
      case 'barbarian':
        return (
          <Path
            data="m13.742 21.83 8.272-8.272-.441-.441 1.875-1.875-2.726-2.726-1.875 1.875-.441-.441-.341.341c-1.184-2.35-.963-5.218 1.157-8.84C8.92-2.685-2.193 9.862 1.372 19.7c3.339-1.941 6.782-2.769 9.352-2.067l-.589.589.441.441-9.905 9.905v2.838h2.614l10.017-10.017.441.441zm16.836-9.023c-3.673 2.149-6.565 2.354-8.93 1.117l-7.278 7.278c.755 2.58-.072 6.068-2.041 9.455 9.838 3.564 22.385-7.548 18.249-17.85z"
            fill="white"
            stroke="grey"
            strokeWidth={1}
            viewBox="0 0 48 48"
          />
        );
      case 'wizard':
        return (
          <Path
            data="M24 40c11.046 0 20-1.79 20-4 0-1.439-3.299-2.7-9-3.405L27 12 15 8l3 6-5 18.595C7.299 33.3 4 34.56 4 36c0 2.21 8.954 4 20 4Z"
            fill="white"
            stroke="grey"
            strokeWidth={1}
            viewBox="0 0 48 48"
          />
        );
      case 'fighter':
        return FighterIcon;
      default:
        return null;
    }
  };

  return (
    <Group
      id={id}
      x={x}
      y={y}
      draggable={draggable}
      dragBoundFunc={dragBoundFunc}
    >
      {classShape()}
      <Text
        x={radius / 9}
        y={radius + 25}
        text={name}
        fontSize={16}
        fontStyle="bold"
        fill="white"
      />
    </Group>
  );
};

export default Player;
```

![image]("https://www.roberthogan.dev/images/projects/dnd-interactive-map/dnd-interactive-map-04-15-23.png")

Pretty happy with the inital set up but there is still a long way to go!

# 4.30.23

## Added Monster svgs and location

### Here is the full Monster component

```js
import { Group, Path, Text } from 'react-konva';

const GoblinIcon = (
  <Group scale={{ x: 0.08, y: 0.08 }}>
    <Path
      data="M256 33c-8.5 0-21.318 5.745-35.06 16.17-13.743 10.425-28.429 25.055-42.167 40.756-19.597 22.397-37.26 47.053-48.41 64.597l49.582 37.188 49.23 12.307 2.288-6.864 17.074 5.692-14.957 44.873 22.42 56.05 22.42-56.05-14.957-44.873 17.074-5.692 2.287 6.864 49.23-12.307 49.583-37.188c-11.15-17.544-28.813-42.2-48.41-64.597-13.738-15.7-28.424-30.33-42.166-40.756C277.318 38.745 264.5 33 256 33zm-91.49 95.213l76 44-9.02 15.574-76-44zm182.98 0l9.02 15.574-76 44-9.02-15.574zM17.21 146.625c31.804 32.973 63.213 73.408 76.3 111.857 1.59-2.708 3.38-5.333 5.292-7.882 5.009-6.68 11.036-12.972 17.14-19.153-8.95-12.884-11.752-29.088-12.605-42.886-29.308-24.142-53.916-37.693-86.127-41.936zm477.582 0c-32.21 4.243-56.819 17.794-86.127 41.936-.853 13.798-3.654 30.002-12.605 42.886 6.104 6.181 12.131 12.474 17.14 19.153 1.912 2.55 3.703 5.174 5.291 7.882 13.088-38.449 44.497-78.884 76.301-111.857zm-373.645 23.484c-.023.045-.054.1-.078.145.137 16.376 2.007 44.095 13.295 55.383l6.364 6.363-6.364 6.363c-8 8-15.74 15.805-21.164 23.037-4.688 6.251-7.327 11.823-7.965 16.452l81.118 30.418c4.7-6.847 9.904-13.253 15.285-18.633l16.029-16.03-.67 22.659c-.25 8.431-.383 16.131-.232 23.41l30.84 11.564L214.707 249h-50.98l-13.364 13.363-12.726-12.726 11.312-11.313-13.531-57.512zm269.708 0l-14.272 10.703-13.531 57.512 11.312 11.313-12.726 12.726L348.273 249h-50.98l-32.897 82.24 30.842-11.566c.15-7.278.018-14.978-.232-23.408l-.672-22.659 16.03 16.03c5.38 5.38 10.584 11.788 15.284 18.634l55.192-20.697 25.926-9.722c-.638-4.63-3.277-10.2-7.965-16.452-5.424-7.232-13.164-15.037-21.164-23.037L371.273 232l6.364-6.363c11.288-11.288 13.158-39.007 13.295-55.383-.024-.045-.055-.1-.078-.145zM157.867 197.65l7.848 33.35H183v-19.975l-10.945-2.736zm196.266 0l-14.188 10.64L329 211.024V231h17.285zM201 215.525V231h19.18l3.287-9.857zm110 0l-22.467 5.618L291.82 231H311zm-205.791 62.51a16.25 16.25 0 0 0-.117 1.256c7.79 37.424 34.985 88.461 66.066 129.256 15.682 20.582 32.34 38.649 47.582 51.271C233.983 472.441 248 479 256 479c8 0 22.017-6.559 37.26-19.182 15.242-12.622 31.9-30.689 47.582-51.271 31.081-40.795 58.277-91.832 66.066-129.256-.02-.41-.063-.83-.117-1.256l-48.027 72.043L256 435.715l-102.764-85.637zm45.756 36.188l15.799 23.699 2.968 2.474c1.753-5.409 4.259-10.906 7.176-16.445zm210.07 0l-25.943 9.728c2.917 5.539 5.423 11.036 7.176 16.445l2.968-2.474zm-162.129 7.73c-1.782 2.76-3.48 5.558-5.006 8.356-4.27 7.83-7.176 15.717-8.328 21.255l19.67 13.114c-4.116-14.232-5.864-28.048-6.336-42.725zm114.188 0c-.472 14.677-2.22 28.493-6.336 42.725l19.67-13.114c-1.152-5.538-4.057-13.425-8.328-21.255-1.527-2.798-3.224-5.596-5.006-8.356zm-19.227 17.457L265 350.236v54.55l7.793-6.495 7.158-14.316c8.04-16.081 12.051-29.95 13.916-44.565zm-75.734.002c1.864 14.614 5.876 28.483 13.916 44.563l7.158 14.316 7.793 6.494v-54.549z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

const DragonIcon = (
  <Group scale={{ x: 0.08, y: 0.08 }}>
    <Path
      data="M188.8 20.38c-5.3 26.85 4.6 55.74 34.1 86.52 11.2-7.29 31.6-10.94 50-8.16-46-22.31-66.5-47.13-84.1-78.36zM29.19 26.62C43.56 73.08 81.09 128.8 129.6 168.3 93.51 166 49.93 153.1 18.76 143c24.96 35.2 64.17 52.9 103.34 66.3C97.13 227 66.99 245 18.66 248c54.64 19.2 107.54 8.9 131.34.7-17.9 34.9-100.72 66.2-122.31 77 53.26 4.2 121.71-11 167.01-32.9 10 24.6-1.6 53.2-10.1 77.8-1.9 4.5-3.8 8.9-5.7 13.3 5.1-3.5 10.1-7 14.9-10.6 23.6-16.2 47.8-31.9 59.5-58.8 26.1 31.2 62.7 62.1 107 85.4 17.4 22.1 28.3 49 34.2 73.8 8.3-19.1 13.8-40.2 9.7-60.3 24.5-3.6 35.6-29.7 35.5-54.4-12.6 6.2-15.1 6.3-31.2 8.2 0-10.1.6-12.5-3-28.7-10.3 8.4-21 11.2-30.8 11.8 2.1-7.6 3-19.5 3.7-27.3-13 7.1-19.2 9.7-30.1 10.8-.4-10.9-.1-20-4.1-30.4-29.6 19-48.6 1.5-68-21.3 19.8-17 96.4-21.8 95.1 7.1 14-7.3 18.8-11.2 23.6-15.9 9.1 8.5 13.4 20.9 15.1 31.4 9.3-9.4 10.3-10.5 17.1-23.8 5.7 10.1 8.8 17 10.7 30.6 8.5-6.2 15.4-13.1 19.8-21.4 7.5 15.5 8.3 16 12.4 33 17.8-13.1 21.8-31.2 22.8-47.6 2-33-.3-108.2-31-142.9 1.7 36.3-13.1 70-33.8 80.7-12.6 4.9-96.5-74.6-137.6-93.3-23.5-10.2-48.1 7.1-67.8 9.3C147 106.2 83.57 70.94 29.19 26.62zM296.1 152.8c13.3 20.9 32.2 36.9 60.1 55-19.4 2.9-65.8-6.7-77.7-24-5.5-7.9 7.1-21.3 17.6-31zM180.6 319.1c-14.4 6.2-29.2 10.9-43.8 14.3-2.4 3.6-4.6 7.1-6.7 10.5 14.8 5.3 31.5 7 44.1 2.8 3.3-9.8 5.5-19.3 6.4-27.6zm-68 19.1l-10.2 1.5c-31.81 36.6-61.9 103.2-48.24 151.9h36.13c-11.12-37.7-16.53-87.1 22.31-153.4zm8.5 21.5c-5.9 11.4-10.4 22.1-13.8 32.1 12.9 6.7 29.1 8.9 44.8 8.2 4.6-10.5 9.8-21.8 14.6-33.3-15.4 1.8-31.4-1.4-45.6-7zm111.4 6.6c-12 10.5-25.2 20.3-38.9 29.6 7 34 33.4 63.4 73.9 95.7h83.3c-57.2-31.8-94.6-73.3-118.3-125.3zm-130 43.2c-2.5 11.8-3.3 22.7-3 32.9 37.3 14.2 62.5 13.5 97.5 4.1-7.2-10.3-13-21-16.9-32.3-32.7 9.4-55.4 5.7-77.6-4.7zm106.6 52.4c-38.1 10.9-68.8 13.2-107.5.3 1.8 10.4 4.5 20.1 7.5 29.4h130.1c-11.3-9.8-21.4-19.6-30.1-29.7z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

const SkeletonIcon = (
  <Group scale={{ x: 0.08, y: 0.08 }}>
    <Path
      data="M256.836,0h-15.032C140.212,0,58.592,75.416,58.592,168.14v95.772c0,31.388,19.532,59.532,50.78,69.004v60.468
			c0,59.784,108.424,106.612,128.54,106.612h22.816c20.112,0,129.896-46.828,129.896-106.612v-60.468
			c31.248-9.468,50.78-37.62,50.78-69.004V168.14C441.408,75.416,358.428,0,256.836,0z M249.32,269.48
			c17.324,0,26.84,44.172,26.84,58.812c0,14.028-8.052,15.916-15.932,15.916c-1.548,0-3.216-0.064-4.976-0.136
			c-3.744-0.152-8.124-0.152-11.852,0c-1.764,0.076-3.428,0.136-4.984,0.136c-3.748,0-8.016-0.352-11.232-2.972
			c-3.208-2.608-4.7-6.724-4.7-12.944C222.484,313.652,232,269.48,249.32,269.48z M139.608,218.868
			c6.84-8.248,16.6-13.212,27.492-13.948l17.244-1.176c23.04-1.524,41.04,10.32,41.04,26.336c0,15.328-15.408,35.172-35.072,45.176
			l-14.96,7.604c-5.276,2.688-10.58,4.048-15.744,4.048c-14.584,0-25.264-10.6-27.236-27.004l-1.368-11.428
			C129.712,237.64,132.764,227.128,139.608,218.868z M365.32,344.72l-37.196,12.624v21.608c0,0.544-0.444,1.108-0.556,1.624
			c-0.872,18.8-17.732,29.58-45.88,29.58h-65.944c-22.008,0-43.868-10.756-43.868-31.204v-21.608l-37.792-12.624
			c-4.088-1.376-6.396-5.8-5.02-9.892c1.368-4.088,5.756-6.3,9.836-4.916l43.096,14.412c3.184,1.072,5.504,4.052,5.504,7.412v27.224
			c0,4.668,2.812,8.108,7.108,10.564c0.54-3.788,4.172-6.712,8.108-6.712c4.312,0,8.22,3.5,8.22,7.812v3.496
			c0,0.236,3,0.416,4.804,0.416h10.82v-3.916c0-4.312,3.5-7.812,7.812-7.812s7.812,3.5,7.812,7.812v3.916h15.624v-3.916
			c0-4.312,3.5-7.812,7.812-7.812s7.812,3.5,7.812,7.812v3.916h8.252c2.032,0,3.464-0.128,7.372-0.32v-3.592
			c0-4.312,3.152-7.812,7.464-7.812c4.236,0,7.488,3.372,7.616,7.58c4.464-2.328,7.928-5.908,7.928-11.428
			c0-0.48,0.424-0.948,0.424-1.408V351.74c0-3.36,1.752-6.34,4.936-7.412l42.716-14.412c4.096-1.384,8.62,0.828,9.988,4.916
			C371.52,338.916,369.412,343.344,365.32,344.72z M372.428,248.472l-1.368,11.424c-1.964,16.408-12.652,27.008-27.232,27.008
			c-5.168,0-10.464-1.36-15.748-4.048l-14.956-7.604c-19.668-10.004-35.072-29.844-35.072-45.176
			c0-16.016,18.052-27.848,41.036-26.336l17.248,1.176c10.888,0.74,20.648,5.7,27.492,13.952
			C370.676,227.128,373.728,237.64,372.428,248.472z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

const Monster = ({ id, name, x, y, draggable, dragBoundFunc, className }) => {
  const radius = 20;
  const classShape = () => {
    switch (className) {
      case 'goblin':
        return GoblinIcon;
      case 'skeleton':
        return SkeletonIcon;
      case 'dragon':
        return DragonIcon;
      default:
        return null;
    }
  };

  return (
    <Group
      id={id}
      x={x}
      y={y}
      draggable={draggable}
      dragBoundFunc={dragBoundFunc}
    >
      {classShape()}
      {/* <Text
        x={radius / 9}
        y={radius + 25}
        text={name}
        fontSize={16}
        fontStyle="bold"
        fill="white"
      /> */}
    </Group>
  );
};

export default Monster;
```

### Here is the updated Map component

```js
function generateMonsters() {
  const monsters = ['goblin', 'skeleton', 'dragon'];
  const mapWidth = window.innerWidth;
  const mapHeight = window.innerHeight;
  const centerX = mapWidth / 2;
  const centerY = mapHeight / 2;
  const exclusionRadius = 200;

  function isOutsideExclusionZone(x, y) {
    const distance = Math.sqrt(
      Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2)
    );
    return distance > exclusionRadius;
  }

  return monsters.map((monsterName, i) => {
    let monsterX, monsterY;

    do {
      monsterX =
        Math.floor(Math.random() * (mapWidth * 0.8 - mapWidth * 0.2)) +
        mapWidth * 0.2;
      monsterY =
        Math.floor(Math.random() * (mapHeight * 0.8 - mapHeight * 0.2)) +
        mapHeight * 0.2;
    } while (!isOutsideExclusionZone(monsterX, monsterY));

    return {
      id: i.toString(),
      x: monsterX,
      y: monsterY,
      className: monsterName,
      isDragging: false,
    };
  });
}
```

The main change here is that we are now generating a random position for each monster, but we are also checking that the position is outside of the exclusion zone. If it is not, we generate a new position. We do this by using a do...while loop. This will keep generating a new position until the position is outside of the exclusion zone.

Next steps would be adding the structures

# 04.25.2023

## Added Structures

I added the Castle, Tower and House Icon and moved to all icons to the following file:

```js
import { Group, Path } from 'react-konva';

export const FighterIcon = (
  <Group scale={{ x: 0.08, y: 0.08 }}>
    <Path
      data="M255.996 0C209.875 55.353 136.065 87.638 53.039 92.25v189.12C53.039 405.914 255.996 512 255.996 512s202.966-106.086 202.966-230.63V92.25C375.926 87.638 302.116 55.353 255.996 0z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

export const WizardIcon = (
  <Group scale={{ x: 1, y: 1 }}>
    <Path
      data="M24 40c11.046 0 20-1.79 20-4 0-1.439-3.299-2.7-9-3.405L27 12 15 8l3 6-5 18.595C7.299 33.3 4 34.56 4 36c0 2.21 8.954 4 20 4Z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

export const BarbarianIcon = (
  <Group scale={{ x: 1, y: 1 }}>
    <Path
      data="m13.742 21.83 8.272-8.272-.441-.441 1.875-1.875-2.726-2.726-1.875 1.875-.441-.441-.341.341c-1.184-2.35-.963-5.218 1.157-8.84C8.92-2.685-2.193 9.862 1.372 19.7c3.339-1.941 6.782-2.769 9.352-2.067l-.589.589.441.441-9.905 9.905v2.838h2.614l10.017-10.017.441.441zm16.836-9.023c-3.673 2.149-6.565 2.354-8.93 1.117l-7.278 7.278c.755 2.58-.072 6.068-2.041 9.455 9.838 3.564 22.385-7.548 18.249-17.85z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

export const HouseIcon = (
  <Group scale={{ x: 0.6, y: 0.6 }}>
    <Path
      data="M62.79,29.172l-28-28C34.009,0.391,32.985,0,31.962,0s-2.047,0.391-2.828,1.172l-28,28
      c-1.562,1.566-1.484,4.016,0.078,5.578c1.566,1.57,3.855,1.801,5.422,0.234L8,33.617V60c0,2.211,1.789,4,4,4h16V48h8v16h16
      c2.211,0,4-1.789,4-4V33.695l1.195,1.195c1.562,1.562,3.949,1.422,5.516-0.141C64.274,33.188,64.356,30.734,62.79,29.172z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

export const TowerIcon = (
  <Group scale={{ x: 1, y: 1 }}>
    <Path
      data="M28.282 30.628l-1.791-5.793h-2.456v-11.772l3.816-4.731v-6.934h-4.020v3.27h-2.447v-3.27h-4.064v3.27h-2.403v-3.27h-4.064v3.27h-2.403v-3.27h-4.020v6.934l3.816 4.731v11.772h-2.456l-1.791 5.793z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

export const ObeliskIcon = (
  <Group scale={{ x: 2, y: 2 }}>
    <Path
      data="M12.25 12.25h-.37L11 2.87a1.21 1.21 0 0 0-.38-.78L8.87.35a1.25 1.25 0 0 0-1.74 0L5.34 2.09a1.21 1.21 0 0 0-.34.78l-.84 9.38h-.41A1.26 1.26 0 0 0 2.5 13.5V16h11v-2.5a1.26 1.26 0 0 0-1.25-1.25zM6.2 3 8 1.25 9.8 3l.83 9.27H5.37zm6.05 11.77h-8.5V13.5h8.5z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

export const GoblinIcon = (
  <Group scale={{ x: 0.08, y: 0.08 }}>
    <Path
      data="M256 33c-8.5 0-21.318 5.745-35.06 16.17-13.743 10.425-28.429 25.055-42.167 40.756-19.597 22.397-37.26 47.053-48.41 64.597l49.582 37.188 49.23 12.307 2.288-6.864 17.074 5.692-14.957 44.873 22.42 56.05 22.42-56.05-14.957-44.873 17.074-5.692 2.287 6.864 49.23-12.307 49.583-37.188c-11.15-17.544-28.813-42.2-48.41-64.597-13.738-15.7-28.424-30.33-42.166-40.756C277.318 38.745 264.5 33 256 33zm-91.49 95.213l76 44-9.02 15.574-76-44zm182.98 0l9.02 15.574-76 44-9.02-15.574zM17.21 146.625c31.804 32.973 63.213 73.408 76.3 111.857 1.59-2.708 3.38-5.333 5.292-7.882 5.009-6.68 11.036-12.972 17.14-19.153-8.95-12.884-11.752-29.088-12.605-42.886-29.308-24.142-53.916-37.693-86.127-41.936zm477.582 0c-32.21 4.243-56.819 17.794-86.127 41.936-.853 13.798-3.654 30.002-12.605 42.886 6.104 6.181 12.131 12.474 17.14 19.153 1.912 2.55 3.703 5.174 5.291 7.882 13.088-38.449 44.497-78.884 76.301-111.857zm-373.645 23.484c-.023.045-.054.1-.078.145.137 16.376 2.007 44.095 13.295 55.383l6.364 6.363-6.364 6.363c-8 8-15.74 15.805-21.164 23.037-4.688 6.251-7.327 11.823-7.965 16.452l81.118 30.418c4.7-6.847 9.904-13.253 15.285-18.633l16.029-16.03-.67 22.659c-.25 8.431-.383 16.131-.232 23.41l30.84 11.564L214.707 249h-50.98l-13.364 13.363-12.726-12.726 11.312-11.313-13.531-57.512zm269.708 0l-14.272 10.703-13.531 57.512 11.312 11.313-12.726 12.726L348.273 249h-50.98l-32.897 82.24 30.842-11.566c.15-7.278.018-14.978-.232-23.408l-.672-22.659 16.03 16.03c5.38 5.38 10.584 11.788 15.284 18.634l55.192-20.697 25.926-9.722c-.638-4.63-3.277-10.2-7.965-16.452-5.424-7.232-13.164-15.037-21.164-23.037L371.273 232l6.364-6.363c11.288-11.288 13.158-39.007 13.295-55.383-.024-.045-.055-.1-.078-.145zM157.867 197.65l7.848 33.35H183v-19.975l-10.945-2.736zm196.266 0l-14.188 10.64L329 211.024V231h17.285zM201 215.525V231h19.18l3.287-9.857zm110 0l-22.467 5.618L291.82 231H311zm-205.791 62.51a16.25 16.25 0 0 0-.117 1.256c7.79 37.424 34.985 88.461 66.066 129.256 15.682 20.582 32.34 38.649 47.582 51.271C233.983 472.441 248 479 256 479c8 0 22.017-6.559 37.26-19.182 15.242-12.622 31.9-30.689 47.582-51.271 31.081-40.795 58.277-91.832 66.066-129.256-.02-.41-.063-.83-.117-1.256l-48.027 72.043L256 435.715l-102.764-85.637zm45.756 36.188l15.799 23.699 2.968 2.474c1.753-5.409 4.259-10.906 7.176-16.445zm210.07 0l-25.943 9.728c2.917 5.539 5.423 11.036 7.176 16.445l2.968-2.474zm-162.129 7.73c-1.782 2.76-3.48 5.558-5.006 8.356-4.27 7.83-7.176 15.717-8.328 21.255l19.67 13.114c-4.116-14.232-5.864-28.048-6.336-42.725zm114.188 0c-.472 14.677-2.22 28.493-6.336 42.725l19.67-13.114c-1.152-5.538-4.057-13.425-8.328-21.255-1.527-2.798-3.224-5.596-5.006-8.356zm-19.227 17.457L265 350.236v54.55l7.793-6.495 7.158-14.316c8.04-16.081 12.051-29.95 13.916-44.565zm-75.734.002c1.864 14.614 5.876 28.483 13.916 44.563l7.158 14.316 7.793 6.494v-54.549z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

export const DragonIcon = (
  <Group scale={{ x: 0.08, y: 0.08 }}>
    <Path
      data="M188.8 20.38c-5.3 26.85 4.6 55.74 34.1 86.52 11.2-7.29 31.6-10.94 50-8.16-46-22.31-66.5-47.13-84.1-78.36zM29.19 26.62C43.56 73.08 81.09 128.8 129.6 168.3 93.51 166 49.93 153.1 18.76 143c24.96 35.2 64.17 52.9 103.34 66.3C97.13 227 66.99 245 18.66 248c54.64 19.2 107.54 8.9 131.34.7-17.9 34.9-100.72 66.2-122.31 77 53.26 4.2 121.71-11 167.01-32.9 10 24.6-1.6 53.2-10.1 77.8-1.9 4.5-3.8 8.9-5.7 13.3 5.1-3.5 10.1-7 14.9-10.6 23.6-16.2 47.8-31.9 59.5-58.8 26.1 31.2 62.7 62.1 107 85.4 17.4 22.1 28.3 49 34.2 73.8 8.3-19.1 13.8-40.2 9.7-60.3 24.5-3.6 35.6-29.7 35.5-54.4-12.6 6.2-15.1 6.3-31.2 8.2 0-10.1.6-12.5-3-28.7-10.3 8.4-21 11.2-30.8 11.8 2.1-7.6 3-19.5 3.7-27.3-13 7.1-19.2 9.7-30.1 10.8-.4-10.9-.1-20-4.1-30.4-29.6 19-48.6 1.5-68-21.3 19.8-17 96.4-21.8 95.1 7.1 14-7.3 18.8-11.2 23.6-15.9 9.1 8.5 13.4 20.9 15.1 31.4 9.3-9.4 10.3-10.5 17.1-23.8 5.7 10.1 8.8 17 10.7 30.6 8.5-6.2 15.4-13.1 19.8-21.4 7.5 15.5 8.3 16 12.4 33 17.8-13.1 21.8-31.2 22.8-47.6 2-33-.3-108.2-31-142.9 1.7 36.3-13.1 70-33.8 80.7-12.6 4.9-96.5-74.6-137.6-93.3-23.5-10.2-48.1 7.1-67.8 9.3C147 106.2 83.57 70.94 29.19 26.62zM296.1 152.8c13.3 20.9 32.2 36.9 60.1 55-19.4 2.9-65.8-6.7-77.7-24-5.5-7.9 7.1-21.3 17.6-31zM180.6 319.1c-14.4 6.2-29.2 10.9-43.8 14.3-2.4 3.6-4.6 7.1-6.7 10.5 14.8 5.3 31.5 7 44.1 2.8 3.3-9.8 5.5-19.3 6.4-27.6zm-68 19.1l-10.2 1.5c-31.81 36.6-61.9 103.2-48.24 151.9h36.13c-11.12-37.7-16.53-87.1 22.31-153.4zm8.5 21.5c-5.9 11.4-10.4 22.1-13.8 32.1 12.9 6.7 29.1 8.9 44.8 8.2 4.6-10.5 9.8-21.8 14.6-33.3-15.4 1.8-31.4-1.4-45.6-7zm111.4 6.6c-12 10.5-25.2 20.3-38.9 29.6 7 34 33.4 63.4 73.9 95.7h83.3c-57.2-31.8-94.6-73.3-118.3-125.3zm-130 43.2c-2.5 11.8-3.3 22.7-3 32.9 37.3 14.2 62.5 13.5 97.5 4.1-7.2-10.3-13-21-16.9-32.3-32.7 9.4-55.4 5.7-77.6-4.7zm106.6 52.4c-38.1 10.9-68.8 13.2-107.5.3 1.8 10.4 4.5 20.1 7.5 29.4h130.1c-11.3-9.8-21.4-19.6-30.1-29.7z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);

export const SkeletonIcon = (
  <Group scale={{ x: 0.08, y: 0.08 }}>
    <Path
      data="M256.836,0h-15.032C140.212,0,58.592,75.416,58.592,168.14v95.772c0,31.388,19.532,59.532,50.78,69.004v60.468
			c0,59.784,108.424,106.612,128.54,106.612h22.816c20.112,0,129.896-46.828,129.896-106.612v-60.468
			c31.248-9.468,50.78-37.62,50.78-69.004V168.14C441.408,75.416,358.428,0,256.836,0z M249.32,269.48
			c17.324,0,26.84,44.172,26.84,58.812c0,14.028-8.052,15.916-15.932,15.916c-1.548,0-3.216-0.064-4.976-0.136
			c-3.744-0.152-8.124-0.152-11.852,0c-1.764,0.076-3.428,0.136-4.984,0.136c-3.748,0-8.016-0.352-11.232-2.972
			c-3.208-2.608-4.7-6.724-4.7-12.944C222.484,313.652,232,269.48,249.32,269.48z M139.608,218.868
			c6.84-8.248,16.6-13.212,27.492-13.948l17.244-1.176c23.04-1.524,41.04,10.32,41.04,26.336c0,15.328-15.408,35.172-35.072,45.176
			l-14.96,7.604c-5.276,2.688-10.58,4.048-15.744,4.048c-14.584,0-25.264-10.6-27.236-27.004l-1.368-11.428
			C129.712,237.64,132.764,227.128,139.608,218.868z M365.32,344.72l-37.196,12.624v21.608c0,0.544-0.444,1.108-0.556,1.624
			c-0.872,18.8-17.732,29.58-45.88,29.58h-65.944c-22.008,0-43.868-10.756-43.868-31.204v-21.608l-37.792-12.624
			c-4.088-1.376-6.396-5.8-5.02-9.892c1.368-4.088,5.756-6.3,9.836-4.916l43.096,14.412c3.184,1.072,5.504,4.052,5.504,7.412v27.224
			c0,4.668,2.812,8.108,7.108,10.564c0.54-3.788,4.172-6.712,8.108-6.712c4.312,0,8.22,3.5,8.22,7.812v3.496
			c0,0.236,3,0.416,4.804,0.416h10.82v-3.916c0-4.312,3.5-7.812,7.812-7.812s7.812,3.5,7.812,7.812v3.916h15.624v-3.916
			c0-4.312,3.5-7.812,7.812-7.812s7.812,3.5,7.812,7.812v3.916h8.252c2.032,0,3.464-0.128,7.372-0.32v-3.592
			c0-4.312,3.152-7.812,7.464-7.812c4.236,0,7.488,3.372,7.616,7.58c4.464-2.328,7.928-5.908,7.928-11.428
			c0-0.48,0.424-0.948,0.424-1.408V351.74c0-3.36,1.752-6.34,4.936-7.412l42.716-14.412c4.096-1.384,8.62,0.828,9.988,4.916
			C371.52,338.916,369.412,343.344,365.32,344.72z M372.428,248.472l-1.368,11.424c-1.964,16.408-12.652,27.008-27.232,27.008
			c-5.168,0-10.464-1.36-15.748-4.048l-14.956-7.604c-19.668-10.004-35.072-29.844-35.072-45.176
			c0-16.016,18.052-27.848,41.036-26.336l17.248,1.176c10.888,0.74,20.648,5.7,27.492,13.952
			C370.676,227.128,373.728,237.64,372.428,248.472z"
      fill="white"
      stroke="grey"
      strokeWidth={1}
      viewBox="0 0 48 48"
    />
  </Group>
);
```

I also refactored all components and types to be more readable and reusable.

The map file looks like this:

```tsx
import React, { useState, useEffect } from 'react';
import { Stage, Layer } from 'react-konva';

import Party from './map-module/components/Party';
import Monsters from './map-module/components/Monsters';
import Structures from './map-module/components/Structures';

const KonvaMap = () => {
  const defaultDragBoundFunc = (pos) => pos;

  const handleTouchMove = (e) => {
    e.evt.preventDefault();
  };

  const [stageSize, setStageSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight,
  });

  useEffect(() => {
    const handleResize = () => {
      setStageSize({ width: window.innerWidth, height: window.innerHeight });
    };
    window.addEventListener('resize', handleResize);

    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []);

  const playerRadius = 20;

  const dragBoundFunc = (pos) => {
    const x = Math.max(
      playerRadius,
      Math.min(pos.x, stageSize.width - playerRadius)
    );
    const y = Math.max(
      playerRadius,
      Math.min(pos.y, stageSize.height - playerRadius)
    );
    return { x, y };
  };

  return (
    <Stage
      width={stageSize.width}
      height={stageSize.height}
      onTouchMove={handleTouchMove}
    >
      <Layer>
        <Party dragBoundFunc={defaultDragBoundFunc} />
        <Monsters dragBoundFunc={defaultDragBoundFunc} />
        <Structures dragBoundFunc={defaultDragBoundFunc} />
      </Layer>
    </Stage>
  );
};

export default KonvaMap;
```
